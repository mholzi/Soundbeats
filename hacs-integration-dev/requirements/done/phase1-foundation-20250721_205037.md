# Phase 1: Foundation & HACS Structure - Requirements Document

## ğŸ“‹ Requirements Certainty Assessment
**Score: 11/12** - Requirements are complete and ready for implementation

### Certainty Breakdown:
- **Problem Clarity**: 2/2 - Crystal clear Phase 1 foundation requirements
- **Scope Definition**: 2/2 - Well-bounded deliverables from planning document  
- **Technical Details**: 2/2 - Complete understanding of HA/HACS architecture
- **Success Criteria**: 2/2 - Measurable checklist provided
- **Edge Cases & Constraints**: 2/2 - HACS validation and naming issues identified
- **UI/UX Criteria**: 1/2 - Basic empty panel specified

## ğŸ¯ Problem Statement

Implement Phase 1 of the Soundbeats Home Assistant integration to create a solid HACS-compliant foundation with basic panel structure. Current codebase has placeholder naming (`your_integration`) and missing panel registration - needs systematic renaming and panel implementation to meet Phase 1 success criteria.

## ğŸ“‹ Detailed Requirements

### 1. Integration Naming & Structure Standardization
**Priority: Critical**

#### Current State Issues:
- Domain: `your_integration` (placeholder)
- Integration name: "Your Integration" 
- Directory: `custom_components/your_integration/`
- All references use placeholder names

#### Requirements:
- **Domain rename**: `your_integration` â†’ `soundbeats`
- **Integration title**: "Your Integration" â†’ "Soundbeats"
- **Directory restructure**: `your_integration/` â†’ `soundbeats/`
- **Update all imports and references** across all files
- **Update manifest.json** with correct domain and name
- **Update const.py** with new DOMAIN constant

### 2. Panel Registration Implementation  
**Priority: Critical**

#### Requirements:
- **Implement panel registration** in `__init__.py:async_setup_entry()`
- **Register static path** for serving frontend assets
- **Panel configuration**:
  - Title: "Soundbeats"
  - Icon: `mdi:music-note` 
  - URL path: `/soundbeats`
  - Admin required: False (allow all users)
- **Create basic frontend structure**:
  - `frontend/index.html` - Panel entry point
  - `frontend/soundbeats-panel.js` - Stub main component
  - Static file serving at `/soundbeats_static/`

#### Technical Pattern:
```python
from homeassistant.components.frontend import async_register_built_in_panel

await hass.http.async_register_static_path(
    "/soundbeats_static", 
    hass.config.path(f"custom_components/{DOMAIN}/frontend"), 
    cache_headers=False
)

async_register_built_in_panel(
    hass,
    component_name="custom",
    sidebar_title="Soundbeats", 
    sidebar_icon="mdi:music-note",
    frontend_url_path="soundbeats",
    config={
        "_panel_custom": {
            "name": "soundbeats-frontend",
            "embed_iframe": True,
            "trust_external": False,
            "js_url": "/soundbeats_static/soundbeats-panel.js",
        }
    },
    require_admin=False,
)
```

### 3. HACS Compliance Requirements
**Priority: High**

#### Missing Files to Create:
- **info.md** - HACS store display information
- **Enhanced README.md** - Installation and usage instructions
- **Update hacs.json** - Fix domains and metadata

#### HACS Validation Requirements:
- Repository not archived âœ…
- Valid manifest.json with version âœ…  
- Proper directory structure âœ…
- info.md for store display âŒ
- Comprehensive README âš ï¸
- Correct hacs.json domains âŒ

#### Content Requirements:
- **info.md**: Integration description, features, setup steps
- **README.md**: HACS installation, configuration, troubleshooting
- **hacs.json**: Update name, domains, and description

### 4. Basic WebSocket Foundation
**Priority: Medium**

#### Requirements:
- **Register WebSocket commands** in `__init__.py`
- **Create basic command handlers** for game state
- **Implement connection management** patterns
- **Add proper error handling** and validation

#### Commands to Implement:
- `soundbeats/get_status` - Get current integration status
- `soundbeats/ping` - Connection test command

### 5. Frontend Asset Structure
**Priority: Medium**

#### Directory Structure to Create:
```
custom_components/soundbeats/frontend/
â”œâ”€â”€ index.html              # Panel entry point
â”œâ”€â”€ soundbeats-panel.js     # Main component stub  
â””â”€â”€ dist/                   # Built files (future)
```

#### File Requirements:
- **index.html**: Basic HTML shell with script loading
- **soundbeats-panel.js**: Minimal Lit element displaying "Soundbeats Game - Coming Soon"
- **Responsive design**: Works on desktop and mobile
- **HA theme integration**: Uses HA CSS variables

## âœ… Success Criteria

### Phase 1 Completion Checklist:
- [ ] **Integration appears in HACS** with proper name "Soundbeats"
- [ ] **Installs without errors** via HACS installation
- [ ] **Sidebar shows "Soundbeats" panel** with music note icon  
- [ ] **Panel loads empty page successfully** showing "Coming Soon" message
- [ ] **All HACS validation checks pass** (GitHub Actions green)
- [ ] **GitHub Actions CI passes** with no errors

### Technical Validation:
- [ ] **No Home Assistant log errors** during integration load
- [ ] **Panel appears in sidebar** after installation
- [ ] **Frontend loads without JavaScript errors** (browser console clean)
- [ ] **Integration survives HA restart** (state persistence working)
- [ ] **HACS validation passes locally** using hacs-action tool

## ğŸ”§ Technical Constraints

### Home Assistant Architecture Requirements:
- **Async/await patterns** - All code must be fully async
- **10-second setup timeout** - Integration must load quickly  
- **Proper cleanup** - WebSocket subscriptions need cleanup handlers
- **Type hints required** - 100% type annotation coverage
- **HA coding standards** - Follow pylint and black formatting

### HACS Publishing Requirements:
- **Single integration per repo** - Repository contains one integration only
- **Active repository status** - Not archived, has recent activity
- **Semantic versioning** - Version in manifest.json follows SemVer
- **Comprehensive documentation** - README with setup and usage
- **Valid metadata** - hacs.json with correct domains and info

### Frontend Integration Constraints:
- **Static file serving** - Use HA's static path registration
- **Panel security model** - No external script loading
- **Mobile responsiveness** - Must work on small screens
- **HA theme compliance** - Use HA CSS variables for theming

## ğŸ§ª Testing Strategy

### Manual Testing Steps:
1. **Installation test**: Install via HACS, verify no errors
2. **Panel visibility test**: Check sidebar shows "Soundbeats" option  
3. **Panel loading test**: Click panel, verify page loads
4. **Restart persistence test**: Restart HA, verify panel still works
5. **Log monitoring**: Check HA logs for any errors or warnings

### Validation Testing:
1. **HACS validation**: Run `hacs-action --category integration`
2. **Hassfest validation**: Home Assistant manifest validation
3. **GitHub Actions**: Verify all CI checks pass
4. **Manual HACS install**: Test complete installation flow

## ğŸ“ File Structure After Phase 1

```
custom_components/soundbeats/
â”œâ”€â”€ __init__.py              # Integration setup + panel registration
â”œâ”€â”€ manifest.json            # HA integration manifest (updated)
â”œâ”€â”€ const.py                 # Constants (updated domain)
â”œâ”€â”€ config_flow.py           # Configuration flow (existing)
â”œâ”€â”€ sensor.py                # Mock sensor (existing)
â”œâ”€â”€ media_player.py          # Mock media player (existing)
â”œâ”€â”€ frontend/                # Frontend assets (NEW)
â”‚   â”œâ”€â”€ index.html           # Panel entry point (NEW)
â”‚   â””â”€â”€ soundbeats-panel.js  # Main component stub (NEW)
â””â”€â”€ translations/            # Translations (existing)
    â””â”€â”€ en.json              # English translations
```

```
Repository root files:
â”œâ”€â”€ hacs.json                # HACS configuration (updated)
â”œâ”€â”€ info.md                  # HACS store info (NEW)
â”œâ”€â”€ README.md                # Installation guide (updated)
â””â”€â”€ .github/workflows/       # CI workflows (existing)
    â””â”€â”€ validate.yaml        # HACS validation
```

## ğŸ¨ UI/UX Requirements

### Panel Appearance:
- **Title**: Display "Soundbeats" in HA sidebar
- **Icon**: Music note icon (`mdi:music-note`)
- **Loading state**: Show "Soundbeats Game - Coming Soon" message
- **Theme integration**: Use HA theme colors and fonts
- **Responsive**: Works on mobile (320px+) and desktop

### User Experience:
- **Fast loading**: Panel appears within 2 seconds
- **Error handling**: Graceful failure with user-friendly messages
- **Accessibility**: Proper ARIA labels and keyboard navigation
- **Consistent**: Matches HA design patterns and behaviors

## ğŸ” Edge Cases & Error Handling

### Installation Edge Cases:
- **Duplicate installations**: Handle existing installations gracefully
- **Version conflicts**: Proper upgrade path from placeholder names
- **Permission issues**: Handle read-only filesystem scenarios

### Runtime Edge Cases:
- **HA restart scenarios**: Panel registration survives restart
- **Network connectivity**: Handle offline scenarios gracefully  
- **Resource constraints**: Minimal memory and CPU usage
- **Multiple users**: Panel works for all HA users simultaneously

### Error Scenarios:
- **Missing frontend files**: Fallback to error message
- **WebSocket failures**: Retry logic with exponential backoff
- **Static file serving issues**: Clear error messages in logs

## ğŸ“Š Success Metrics

### Quantitative Metrics:
- **Load time**: Integration setup < 5 seconds
- **Bundle size**: Frontend assets < 100KB (Phase 1)
- **Memory usage**: < 10MB additional RAM usage
- **Error rate**: 0 errors in standard installation flow

### Qualitative Metrics:  
- **HACS approval**: Integration approved for HACS store
- **User feedback**: Positive feedback on installation simplicity
- **Developer experience**: Clean code structure for future phases
- **Documentation quality**: Clear setup instructions for end users

---

## ğŸ“‹ Implementation Notes

### Development Workflow:
1. **Rename integration** (systematic find/replace)
2. **Implement panel registration** (following HA patterns)
3. **Create basic frontend** (minimal viable panel)
4. **Fix HACS compliance** (documentation and metadata)
5. **Test end-to-end** (installation through panel loading)

### Risk Mitigation:
- **Backup current code** before major renaming
- **Test frequently** to catch issues early
- **Follow HA development practices** exactly
- **Use established patterns** from successful integrations

This requirements document provides comprehensive guidance for implementing Phase 1 with high confidence in successful completion.